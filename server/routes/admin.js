const express = require("express"); const { adminAuth } = require("../middleware/auth"); const Registration = require("../models/Registration"); const User = require("../models/User"); const router = express.Router(); router.use(adminAuth); router.get("/registrations", async (req, res) => { try { const registrations = await Registration.find().sort({ timestamp: -1 }); res.json(registrations); } catch (error) { console.error("Error fetching registrations:", error); res.status(500).json({ error: "Server error" }); } }); router.get("/users", async (req, res) => { try { const users = await User.find().select("-password").sort({ createdAt: -1 }); res.json(users); } catch (error) { console.error("Error fetching users:", error); res.status(500).json({ error: "Server error" }); } }); router.delete("/registrations/:id", async (req, res) => { try { const registration = await Registration.findByIdAndDelete(req.params.id); if (!registration) { return res.status(404).json({ error: "Registration not found" }); } res.json({ message: "Registration deleted successfully" }); } catch (error) { console.error("Error deleting registration:", error); res.status(500).json({ error: "Server error" }); } }); module.exports = router;
